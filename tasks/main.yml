---
- name: Create container
  community.general.lxc_container:
    name: "{{ item.name }}"
    state: started
    template: "{{ item.template }}"
    template_options: "{{ item.opts }}"
    backing_store: dir #loop
    container_config:
      - "lxc.start.auto = 1"
      - "lxc.net.0.type = veth"
      - "lxc.net.0.link = lxcbr0"
      - "lxc.net.0.flags = up"
  loop: "{{ containers }}"

- name: Remove absent containers
  community.general.lxc_container:
    name: "{{ item }}"
    state: absent
  loop: "{{ absent_containers }}"